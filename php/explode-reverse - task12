<?php
mb_internal_encoding('utf-8');
/* Задание: Задание: дан текст из нескольких предложений, предложение состоит из русских слов, разделенных пробелами. Написать программу, переставляющую слова в предложениях 
в обратном порядке. Cделать программу необходимо, чтобы в результате не было слов с большой буквы в конце предложения, но в начале была, точки в конце быть должны, а старых запятых нет. */
$text = "Кажется, нас обнаружили! надо срочно уходить отсюда. Бежим же скорее!";

/* Делает первую букву предложения заглавной */
    $regexp="/.*?[.?!](?:\s|)/ui"; //ищет конец предложения
      preg_match_all($regexp, $text, $s); //формируем массив из предложений
         foreach ($s[0] as $key1=>$value1){
         $value2.=$value1;
}

$a = str_replace( "," , "" , $value2);  //избавляемся от знаков внутри предложения


$array2=preg_split("/[\.?!]/", $a, -1, PREG_SPLIT_NO_EMPTY);
foreach ($array2 as $key2=>$value2){
$razobrat = explode(' ', $value2); //из вида строки в массив по словам
$g=array_reverse($razobrat); //изменение порядка слов в предложении
$value2 = mb_strtolower(implode(" ", $g));  //приведение всех букв к строчному размеру и возвращение в вид строки
$value2 = preg_replace("/([^,])(\s)(\s+)/u", "$1,$3", $value2) . '.';  
$add.=$value2; 
}



   preg_match_all($regexp, $add, $items);
    foreach ($items[0] as $key => $value){
        $char = mb_strtoupper(substr($value,0,2), "utf-8"); //замена строчной буквы на заглавную
        $value[0] = $char[0];
        $value[1] = $char[1];
        $upFirstLetter.=$value; // первая буква предложения всегда заменена на заглавную
    }

   
    $regexp3="/([^\s])\s?([.,?!:;])\s?([^\s])/u"; // ищет строчную букву после точки
  $replacement3="\$1\$2 \$3"; // разделение между знаком и буквой
   $result=preg_replace($regexp3, $replacement3 , $upFirstLetter);
echo $text;
echo "\n";
echo $result;
