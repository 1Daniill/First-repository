<?php
mb_internal_encoding('utf-8');
/*Дан неграмотно написанный текст, состоящий из нескольких предложений на русском языке. Ошибки заключаются в неправильной расстановке пробелов и отсутствии заглавных букв. Исправь текст так, чтобы все предложения в нем начинались с большой буквы, а после знаков запятая, точка, точка с запятой, двоеточие, восклицательный и вопросительный знак стоял ровно один пробел (а перед ними — ни одного).*/



$text = "много их в Петербурге,молоденьких дур,сегодня в атласе да бархате,а завтра , поглядишь , метут улицу вместе с голью кабацкою...в самом деле ,что было бы с нами ,если бы вместо общеудобного правила:чин чина почитай , ввелось в употребление другое,например:ум ума почитай?какие возникли бы споры!"; //«Станционный смотритель» — повесть Александра Пушкина


 $regexp1='/  +/ui';  //ищет много пробелов
   $replacement1=" "; // Замена нескольких пробелов на один
     $a = preg_replace( $regexp1 , $replacement1 , $text);
      
 
 $regexp2="/.*?[.?!](?:\s|)/ui"; //ищет конец предложения
   preg_match_all($regexp2, $a, $items); 
     foreach ($items[0] as $key => $value){
     $char = mb_strtoupper(substr($value,0,2), "utf-8"); //замена строчной буквы на заглавную
     $value[0] = $char[0];
     $value[1] = $char[1];
     $upFirstLetter.=$value; // первая буква предложения всегда заменена на заглавную
}


 $regexp3="/([^\s])\s?([.,?!:;])\s?([^\s])/u"; // ищет строчную букву после точки
  $replacement3="\$1\$2 \$3"; // разделение между знаком и буквой
   $result=preg_replace($regexp3, $replacement3 , $upFirstLetter);
     
     
    echo $result;


preg_match_all("/.*?[.?!](?:\s|)/s", $a, $items); //Работает, меняя первую строчную на заглавную, но только с ASCII
foreach ($items[0] as $key => $value){
$value=ucfirst($value);
}

?>
